(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("react");var n=e.n(t);const r=require("express");var a=e.n(r);const o=require("fs");var l=e.n(o);const u=require("path");var i=e.n(u);const c=require("react-dom/server"),s=require("@babel/runtime/helpers/toConsumableArray");var f=e.n(s);const d=require("@babel/runtime/helpers/asyncToGenerator");var m=e.n(d);const p=require("@babel/runtime/helpers/slicedToArray");var v=e.n(p);const h=require("@babel/runtime/regenerator");var y=e.n(h);const g=require("lottie-web");var E=e.n(g);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw o}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function w(e){return/^[A-Za-z0-9]{4}-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}$/.test(e)}function S(e){return f()(new Set(e))}function x(e){localStorage.setItem("activationHistory",JSON.stringify(e))}function k(e,t){return A.apply(this,arguments)}function A(){return A=m()(y().mark((function e(t,n){var r,a,o,l=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]?l[2]:null,e.next=3,fetch(t,{method:n,headers:{"Content-Type":"application/json"},body:r?JSON.stringify(r):null});case 3:return a=e.sent,e.next=6,a.json();case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function q(e){return{id:e,name:"奖励 "+e,description:"兑换奖励的描述",amount:Math.floor(10*Math.random())+1}}var I=function(){var e=m()(y().mark((function e(t,n,r){var a,o,l,u,i,c,s,f,d;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],o=[],l=t.length,u=0,i=function(){var e=m()(y().mark((function e(t){var n,i,c,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b(t),e.prev=1,n.s();case 3:if((i=n.n()).done){e.next=19;break}return c=i.value,e.prev=5,e.next=8,k(c);case 8:(s=e.sent).success?a.push(s):o.push(c),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),o.push(c);case 15:u+=1,r&&r(u,l);case 17:e.next=3;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(1),n.e(e.t1);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,21,24,27],[5,12]])})));return function(t){return e.apply(this,arguments)}}(),c=[];t.length;)c.push(t.splice(0,n));s=0,f=c;case 8:if(!(s<f.length)){e.next=15;break}return d=f[s],e.next=12,i(d);case 12:s++,e.next=8;break;case 15:return e.abrupt("return",{results:a,failedCodes:o});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();const T={},O={},j=function(){return(0,t.useEffect)((function(){return E().loadAnimation({container:document.getElementById("success-animation-container"),animationData:O,loop:!1,autoplay:!0}),function(){return E().destroy()}}),[]),n().createElement("div",{id:"success-animation-container",style:{width:200,height:200,margin:"0 auto"}})},D=require("web-vitals"),M=function(){var e=(0,t.useState)(""),r=v()(e,2),a=r[0],o=r[1],l=(0,t.useState)(!1),u=v()(l,2),i=u[0],c=u[1],s=(0,t.useState)(0),d=v()(s,2),p=d[0],h=d[1],g=(0,t.useState)([]),b=v()(g,2),C=b[0],k=b[1],A=(0,t.useState)(null),O=v()(A,2),M=O[0],P=O[1],F=(0,t.useState)([]),N=v()(F,2),_=N[0],z=N[1],B=(0,t.useState)([]),H=v()(B,2),J=H[0],R=H[1],Z=(0,t.useState)(!1),L=v()(Z,2),W=L[0],$=L[1],G=(0,t.useState)(!1),U=v()(G,2),V=U[0],K=U[1];(0,t.useEffect)((function(){i&&E().loadAnimation({container:document.getElementById("lottie-animation"),animationData:T,loop:!0,autoplay:!0})}),[i]),(0,t.useEffect)((function(){alert(888);var e,t=function(){var e=localStorage.getItem("activationHistory");return e?JSON.parse(e):[]}();k(t),(e=console.log)&&e instanceof Function&&((0,D.getCLS)(e),(0,D.getFID)(e),(0,D.getLCP)(e),(0,D.getTTFB)(e),(0,D.getFCP)(e),(0,D.getINP)(e))}),[]);var Q=function(){var e=m()(y().mark((function e(){var t,n,r,o,l,u,i,s,d,m;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.split("\n").map((function(e){return e.trim()})),n=S(t),c(!0),R([]),h(0),r=n.length,o=0,e.next=9,I(n,5,(function(e,t){o=e;var n=Math.round(o/r*100);h(n)}));case 9:l=e.sent,u=l.results,i=l.failedCodes,s=u.length,d=i.length,P({successCount:s,failedCount:d}),R(i),c(!1),K(s>0),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"SAVE_REDEMPTION",payload:{date:new Date,successCount:s,failedCount:d,failedCodes:i}}),m=[].concat(f()(C),[{date:new Date,successCount:s,failedCount:d,failedCodes:i}]),k(m),x(m);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=m()(y().mark((function e(){var t,n,r,a,o,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(!0),e.next=3,I(r,5);case 3:t=e.sent,n=t.results,r=t.failedCodes,a=n.length,o=r.length,P({successCount:a,failedCount:o}),R(r),$(!1),l=[].concat(f()(C),[{date:new Date,successCount:a,failedCount:o,failedCodes:r}]),k(l),x(l);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n().createElement("div",null,n().createElement("h1",null,"游戏激活码兑换系统"),n().createElement("textarea",{value:a,onChange:function(e){o(e.target.value)},placeholder:"请输入激活码，每行一个",rows:"5",cols:"40"}),n().createElement("button",{onClick:function(){alert(888);var e=S(a.split("\n").map((function(e){return e.trim()})).filter(w));console.log("uniqueCodes",e),o(e.join("\n"));var t=e.map(q);console.log("preview",t),z(t)}},"验证激活码"),n().createElement("div",null,n().createElement("h3",null,"待兑换内容预览"),n().createElement("ul",null,_.map((function(e,t){return n().createElement("li",{key:t},n().createElement("div",null,"奖励名称: ",e.name),n().createElement("div",null,"奖励描述: ",e.description),n().createElement("div",null,"奖励数量: ",e.amount))})))),i?n().createElement("div",null,n().createElement("div",{id:"lottie-animation",style:{width:200,height:200}}),n().createElement("div",null,"兑换进度: ",p,"%")):n().createElement("button",{onClick:Q},"开始兑换"),V&&!i&&n().createElement("div",null,n().createElement("h3",null,"兑换成功!"),n().createElement(j,null),"  "),M&&n().createElement("div",null,n().createElement("h3",null,"兑换结果"),n().createElement("div",null,"成功: ",M.successCount,"，失败: ",M.failedCount),J.length>0&&n().createElement("div",null,n().createElement("h4",null,"失败的激活码："),n().createElement("ul",null,J.map((function(e,t){return n().createElement("li",{key:t},e)}))),n().createElement("button",{onClick:X,disabled:W},W?"重试中...":"重试失败的兑换"))),n().createElement("h3",null,"兑换历史"),n().createElement("ul",null,C.map((function(e,t){return n().createElement("li",{key:t},e.date," - 成功: ",e.successCount,"，失败: ",e.failedCount,e.failedCodes&&n().createElement("div",null,n().createElement("strong",null,"失败的激活码:"),n().createElement("ul",null,e.failedCodes.map((function(e,t){return n().createElement("li",{key:t},e)})))))}))))};var P=a()();P.use(a().static(i().resolve(__dirname,"../dist"))),P.get("/",(function(e,t){var r=i().resolve("./public/index.html"),a=l().readFileSync(r,"utf-8"),o=(0,c.renderToPipeableStream)(n().createElement(M,null),{onShellReady:function(){var e=a.split('<div id="root"></div>')[0],n=a.split('<div id="root"></div>')[1];t.setHeader("Content-Type","text/html; charset=utf-8"),t.write(e),o(t,{onCompleteAll:function(){t.write(n),t.write("</body></html>"),t.end()}})},onError:function(e){console.error(e),t.status(500).send("Something went wrong")}}).pipe})),P.listen(5001,(function(){console.log("SSR server is running on http://localhost:5001")}))})();